<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/d3-axis.v1.min.js"></script>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div id="layout">
      <!-- <h2>Bar chart example</h2> -->
      <div id="container">
        <svg></svg>
      </div>
    </div>
    <script type="module">
      import { dataset } from "./Const.js";

      const m = 60;
      const w = 1000 - 2 * m;
      const h = 600 - 2 * m;

      const svg = d3.select("svg");

      const chart = svg.append("g").attr("transform", `translate(${m}, ${m})`);

      const yScale = d3
        .scaleLinear()
        .range([h, 0])
        .domain([0, 100]);

      chart.append("g").call(d3.axisLeft(yScale));

      const xScale = d3
        .scaleBand()
        .domain(dataset.map(p => p.fruit))
        .range([0, w])
        .padding(0.2);
      chart
        .append("g")
        .attr("transform", `translate(0, ${h})`)
        .call(d3.axisBottom(xScale));
      chart
        .selectAll()
        .data(dataset)
        .enter()
        .append("rect")
        .attr("x", s => xScale(s.fruit))
        .attr("y", s => yScale(s.value))
        .attr("height", s => h - yScale(s.value))
        .attr("width", xScale.bandwidth())
        .attr("class", "color");

      chart
        .append("g")
        .attr("class", "grid")
        .attr("transform", `translate(0, ${h})`)
        .call(
          d3
            .axisBottom()
            .scale(xScale)
            .tickSize(-h, 0, 0)
            .tickFormat("")
        );

      chart
        .append("g")
        .attr("class", "grid")
        .call(
          d3
            .axisLeft()
            .scale(yScale)
            .tickSize(-w, 0, 0)
            .tickFormat("")
        );
      svg
        .append("text")
        .attr("x", -(h / 2) - m)
        .attr("y", m / 2.4)
        .attr("transform", "rotate(-90)")
        .attr("text-anchor", "middle")
        .text("MEDIDO(%)");

      svg
        .append("text")
        .attr("x", w / 2 + m)
        .attr("y", 40)
        .attr("text-anchor", "middle")
        .text("FRUTAS MAS COMUNES EN 2019");
      svg
        .append("text")
        .attr("class", "label")
        .attr("x", w / 2 + m)
        .attr("y", h + m * 1.7)
        .attr("text-anchor", "middle")
        .text("FRUTAS");
    </script>
  </body>
</html>
